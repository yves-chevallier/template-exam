\documentclass[a4paper,twoside,addpoints]{exam}
\usepackage{fontspec}
\usepackage[french]{babel}

\usepackage{amsmath}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{siunitx}
\usepackage{qrcode}
\usepackage{float}
\usepackage{tabulary}
\usepackage{xpatch}
\usepackage{xcolor}
\usepackage{tikz}
\usepackage{realboxes}
\usepackage{parskip}
\usepackage{inconsolata}
\usepackage[framemethod=tikz]{mdframed}
\usepackage[most,xparse,skins,breakable]{tcolorbox}
\usetikzlibrary{calc}
\usepackage{tabularx,ragged2e}
\usepackage{zref-savepos}
\usepackage{heiglogo}
\usepackage{bashful}
\usepackage{xstring}
\usepackage{booktabs}

\def\theyear{2026}
\def\thedate{2026-05-01}

\def\documentType{Travail Écrit}

\def\department{TIN}
\def\school{HEIG-VD}
\def\duration{90 minutes}
\def\orientations{Informatique}
\def\course{Programmation C}
\def\examtype{TE}
\def\commit{}
\def\commiturl{}

\title{\documentType{} \course{} \orientations}


\author{Prof. Yves Chevallier}

\vtword{Total}
\vqword{Problème}

\setlength{\gridsize}{4mm}
\setlength{\gridlinewidth}{0.15pt}

\definecolor{GithubGray}{rgb}{0.9,0.9,0.9}
\definecolor{FillWithDottedLinesColor}{gray}{0.6}

\colorfillwithdottedlines

\newtcolorbox{examrules}[1][]{%
  enhanced jigsaw,
  sharp corners,
  colback=white,
  borderline={1pt}{-2pt}{black},
  #1
}

\lstset{
    language=c,
    breaklines=true,
    keywordstyle=\bfseries\color{black},
    basicstyle=\ttfamily\color{black}\fontsize{9pt}{10pt}\selectfont,
    emphstyle={\em \color{gray}},
    keepspaces=true,
    showspaces=false,
    showtabs=false,
    tabsize=3,
    upquote=true,
    aboveskip=2pt,
    belowskip=2pt,
    framexleftmargin=0pt,
    extendedchars=true,
    literate=
    {à}{{\`a}}1
    {è}{{\`e}}1
    {é}{{\'e}}1
    {É}{{\'E}}1
    {ê}{{\^e}}1
    {î}{{\^i}}1
    {ö}{{\"o}}1
    {°}{\textdegree}1
    {ç}{{\c{c}}}1
}

\mdfsetup{
  roundcorner=4pt,
  innerleftmargin=4pt,
  innerrightmargin=4pt,
  innertopmargin=10pt,
  innerbottommargin=2pt,
  linecolor=black!60,
  linewidth=0.5pt,
  backgroundcolor=white!5,
  skipabove=1ex,
}

\newmdenv[innerleftmargin=4pt]{codeframe}


\newcommand{\CD}[1]{\Colorbox{GithubGray}{\lstinline{#1}}}

\makeatletter
\def\@maketitle{%
  \newpage
  \heiglogo[color=black]
  \null
  \vskip 10em%
  \begin{center}%
  \let \footnote \thanks
    {\LARGE \@title \par}%
    \ifprintanswers
    \large \textbf{Solution}
    \fi
    \vskip 1.0em%
    {\itshape\department\par}%
    \vskip .2em%
    {\itshape\school\par}%
    \vskip 3.0em%
    {
      \lineskip .2em%
      \begin{minipage}{0.8 \textwidth}%
      \begin{center}
      \begin{tabular}[t]{c}%
        \@author
      \end{tabular}\par
      \end{center}
    \end{minipage}
    }
    \vskip 1em%
    {\large \thedate}%
  \end{center}%
  \par
  \vskip 1.5em}

%% Headers and footers
\firstpageheader{\school~/~\ifprintanswers Solution \fi \documentType~\course}{}{\enspace\makebox[6cm]{}\bfseries Nom/Prénom :\enspace\makebox[6cm]{\hrulefill}}
\runningheader{\school~/~\ifprintanswers Solution \fi \documentType~\course}{}{\enspace\makebox[6cm]{}\bfseries Nom/Prénom :\enspace\makebox[6cm]{\hrulefill}}

\footer{\rightmark}
  {Page \thepage\ sur \pageref{LastPage}}
  {\course}%{\iflastpage{Fin du travail.}{Aller à la page suivante\ldots}}

\pagestyle{foot}

% Configure the question title
\qformat{%
  \xdef\rightmark{Problème \thenumquestions~-- \thequestiontitle}%
  \Large\textbf{Problème \thenumquestions~-- \thequestiontitle}%
  \quad ~ \large \emph{(\thepoints)} \hfill
  \vrule depth 1.5em width 0pt
  \thispagestyle{headandfoot}%
}

\newcommand*{\cleartoleftpage}{%
  \clearpage
    \if@twoside
    \ifodd\c@page
    \thispagestyle{foot}
      \hbox{}\newpage
      \if@twocolumn
      \thispagestyle{foot}
        \hbox{}\newpage
      \fi
    \fi
  \fi
}
\makeatother

\newcommand{\problemcover}[3]{
  \thispagestyle{foot}
  {\null
  \vskip 10em%
  \begin{center}%
    {\LARGE Problème #1 \par}%
    \vskip 1.0em%
    {\Large #2 \par}%
    \vskip 5em%
    \partialgradetable{#3}[v][questions]  \vspace*{10ex}
  \end{center}%
  \par
  \vskip 1.5em}
  \clearpage
}

\newcounter{NoTableEntry}
\renewcommand*{\theNoTableEntry}{NTE-\the\value{NoTableEntry}}

\newcommand*{\strike}[2]{%
  \multicolumn{1}{#1}{%
    \stepcounter{NoTableEntry}%
    \vadjust pre{\zsavepos{\theNoTableEntry t}}% top
    \vadjust{\zsavepos{\theNoTableEntry b}}% bottom
    \zsavepos{\theNoTableEntry l}% left
    \hspace{0pt plus 1filll}%
    #2% content
    \hspace{0pt plus 1filll}%
    \zsavepos{\theNoTableEntry r}% right
    \tikz[overlay]{%
      \draw
        let
          \n{llx}={\zposx{\theNoTableEntry l}sp-\zposx{\theNoTableEntry r}sp-\tabcolsep},
          \n{urx}={\tabcolsep},
          \n{lly}={\zposy{\theNoTableEntry b}sp-\zposy{\theNoTableEntry r}sp},
          \n{ury}={\zposy{\theNoTableEntry t}sp-\zposy{\theNoTableEntry r}sp}
        in
        (\n{llx}, \n{lly}) -- (\n{urx}, \n{ury})
      ;
      \draw
        let
          \n{llx}={\zposx{\theNoTableEntry l}sp-\zposx{\theNoTableEntry r}sp-\tabcolsep},
          \n{urx}={\tabcolsep},
          \n{lly}={\zposy{\theNoTableEntry b}sp-\zposy{\theNoTableEntry r}sp},
          \n{ury}={\zposy{\theNoTableEntry t}sp-\zposy{\theNoTableEntry r}sp}
        in
        (\n{llx}, \n{ury}) -- (\n{urx}, \n{lly})
      ;
    }%
  }%
}

\lstMakeShortInline|

\begin{document}
\unframedsolutions

\renewcommand{\solutiontitle}{}
\begin{coverpages}
  \maketitle
  \thispagestyle{empty}

  \begin{center}
    \noindent Durée : \duration~minutes
    \vfil
    %La note est calculée par la relation : $\text{note} = \sfrac{\text{total}}{10} + 1$.
  \end{center}

  \begin{center}
    \gradetable[v][questions]
  \end{center}
  \vfil
  \begin{center}
    \begin{examrules}
      \textbf{Consignes : }
      \vskip 1em%
      \begin{itemize}
        \item Écrire votre \textbf{nom} et votre \textbf{prénom} lisiblement sur chaque page.
        \item Écrire lisiblement, au stylo ou au crayon à papier gras.
        \item Répondre aux questions dans les zones appropriées.
        \item Relire toutes vos réponses avant de rendre votre travail.
        \item Vérifier que vous n'avez pas oublié de compléter une page de l'examen.
        \item Rendre toutes les feuilles, une feuille par problème.
        \item Rendre toutes les feuilles de brouillon ainsi que la page de couverture.
        \item Les réponses données sur les feuilles de brouillon ne sont ni acceptées ni corrigées.
        \item Aucun moyen de communication autorisé.
        \item Toutes les réponses concernent le langage C et son standard C17 (\textsf{ISO/IEC 9899\string:2018}).
      \end{itemize}
    \end{examrules}
  \end{center}
\end{coverpages}

\newpage
\thispagestyle{empty}
\null\vfill
\newpage
\setcounter{page}{1}

% Input all questions/problems
\begin{questions}
\input{problem1}
\end{questions}

% End of cover pages
\clearpage
\thispagestyle{empty}
\null
\label{LastPage}
\clearpage
\thispagestyle{empty}
\null
\vfill

\begin{center}
  Fin de l'examen.
\end{center}
\vskip 2em
\raggedleft\commit\quad\qrcode{\commiturl}

\end{document}
